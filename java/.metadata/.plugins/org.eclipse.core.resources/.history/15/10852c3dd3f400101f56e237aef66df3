package com.test.java.lambda;

import java.io.File;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.Iterator;
import java.util.List;
import java.util.function.Consumer;
import java.util.stream.IntStream;
import java.util.stream.Stream;

import com.test.data.Data;
import com.test.data.Item;

public class Ex71_Stream {
	
	public static void main(String[] args) {
		
		/*
		
			자바의 스트림
			1. 입출력
				- 파일 입출력, 콘솔 입출력, 네트워크 입출력..
			
			2. 스트림
				- Java 8(JDK 1.8) > 람다식 + 함수형 인터페이스 + 스트림
				- 배열(컬렉션) 등의 탐색(조작) 기술
				
			
			표준 API 함수형 인터페이스
			
			1. Consumer
				- (매개변수) -> {}
				
			2. Supplier
				- () -> {반환값}
				
			3. Function
				- (매개변수) -> {반환값}
				
			4. Operator
				- (매개변수) -> {반환값}
				- 매개변수 자료형 == 반환값 자료형
			
			5. Predicate
				- (매개변수) -> {반환값}
				- 반환값이 boolean
				
				
			스트림, Stream
			- 특정 데이터 집합(소스)으로부터 생성
			
			
			파이프, pipe
			- 스트림 객체를 통해서 호출되는 메서드
			- 중간 파이프 > 반환값이 Stream
			- 최종 파이프 > 반환값이 Stream이 아닌 나머지
			
			최종 처리
			- forEach(Consumer)
			- 최종 파이프
			- 앞의 스트림으로부터 데이터를 받아 최종 처리하는 메서드
			
			필터링
			- filter(Predicate)
			- 중간 파이프
			- 앞의 스트림으로부터 데이터를 받아 조건에 맞는 요소만 남기고 맞지 않는 요소는 버린다.
			
			중복 제거
			- distinct()
			- 중간 파이프
			- 앞의 스트림으로부터 데이터를 받아 중복값을 제거한다.
			
			변환(*****)
			- map(Function), mapXXX(Function)
			- 중간 파이프
			- 앞의 스트림으로부터 요소를 받아 다른 형태로 변환 후 새로운 스트림 반환
			
			정렬
			- sorted(Comparator)
			- 중간 파이프
			- 사용법이 기존(Collections.sort(), Arrays.sort())과 동일
			
			매칭
			- allMatch(), anyMatch(), noneMatch()
			- 최종 파이프
			- boolean allMatch(Predicate): 모든 요소가 조건을 모두 만족하는지?
			- boolean anyMatch(Predicate): 일부 요소가 조건을 만족하는지?
			- boolean noneMatch(Predicate): 모든 요소가 조건을 불만족하는지?
			
		*/
		
		//m1();
		//m2();
		//m3();
		//m4();
		//m5();
		//m6();
		//m7();
		m8();
		
		
		
	}//main

	private static void m8() {
		
		// int[] nums = { 2, 4, 6, 8, 10 };
		
		List<Integer> nums = List.of(2, 4, 6, 8, 10); // 읽기 전용(수정x)
//		nums.add(12); // 에러
//		nums.remove(0); // 에러
		
		// nums에 짝수만 있는지? > true, false
		boolean result = false;
		
		for (int n : nums ) {
			if (n % 2 == 1) {
				result = true;
				break;
			}
		}
		System.out.println(result);
		
		result = nums.stream().allMatch(num -> num % 2 == 0);
		System.out.println(result);
		
		
		result = Data.getUserList().stream()
								   .filter(user -> user.getHight() >= 180)
								   .allMatch(user -> user.getGender() == 1);
		System.out.println(result);
		
	}

	private static void m7() {
		
		Data.getIntList(10)
			.stream()
			//.sorted((a, b) -> b - a)
			//.sorted(Comparator.naturalOrder()) // (a, b) -> a - b
			.sorted(Comparator.reverseOrder()) // (a, b) -> b - a
			.forEach(n -> System.out.println(n));
		
	}

	private static void m6() {
		
		List<String> list = Data.getStringList(10);
		System.out.println(list);
		System.out.println();
		
		// 각 단어 > (변환) > 글자수
		List<Integer> result = new ArrayList<Integer>();
		
		for (String str : list) {
			result.add(str.length());
		}
		System.out.println(result);
		
		list.stream()
			.map(word -> word.substring(0, 2)) // 반환값으로 구성된 스트림 생성
			.forEach(word -> System.out.println(word));
		
		list.stream()
			.map(word -> word.length())
			.forEach(length -> System.out.println(length));
		
		list.stream()
			.map(word -> word.length() >= 5 ? "긴단어" : "짧은단어")
			.forEach(result2 -> System.out.println(result2));
		System.out.println();
		
		// User 배열
		Data.getUserList().stream()
						  //.map(user -> user.getName())
						  //.map(user -> user.getAge())
						  .map(user -> user.getGender() == 1 ? "남자" : "여자")
						  .forEach(result3 -> System.out.println(result3));
		
		String[] names = { "홍길동", "아무개", "강아지", "고양이", "병아리" };
		
		// com.test.java.lambda
		//new User(이름, 나이, 주소) x 5개
		
		//String[] names > (변환) > List<User> ulist
		List<User> ulist = new ArrayList<User>();
		
		for (String name : names) {
			User u = new User(name, 20, "서울시");
			ulist.add(u);
		}
		
		System.out.println();
		Arrays.stream(names)
			 . map(name -> new User(name, 20, "서울시"))
			 .forEach(user -> System.out.println(user));
		System.out.println();
	}

	private static void m5() {
		
		List<Integer> nums = Data.getIntList(10);
		System.out.println(nums);
		System.out.println(nums.size());
		System.out.println(nums.stream().count());
		System.out.println();
		
		System.out.println(nums.stream().distinct().count());
		System.out.println();
		
		
		int[] nums2 = { 10, 20, 30, 10, 10, 10, 10 };
		System.out.println(Arrays.stream(nums2).distinct().count());
		System.out.println();
		
		
		// filter, distinct 순서
		Data.getStringList().stream()
							.filter(word -> word.length() >= 5)
							.distinct()
							.forEach(word -> System.out.println(word));
		System.out.println();
		
		Data.getStringList().stream()
							.distinct()
							.filter(word -> word.length() >= 5)
							.forEach(word -> System.out.println(word));
		System.out.println();
		
	}

	private static void m4() {
		
		List<Integer> list = Data.getIntList(20);
		System.out.println(list);
		
		// 짝수만 출력
		for (int i = 0; i < list.size(); i++) {
			if (list.get(i) % 2 == 0) {
				System.out.printf("%-4d", list.get(i));
			}
		}
		System.out.println();
		
		
		list.stream().forEach(n -> {
			if (n % 2 == 0) {
				System.out.printf("%-4d", n);
			}
		});
		System.out.println();
		
		
		list.stream()
			.filter(n -> n % 2 == 0)
			.forEach(n -> System.out.printf("%-4d", n));
		System.out.println();
		
		
		list.stream()
			.filter(n -> n % 2 == 0 && n >= 50)
			.forEach(n -> System.out.printf("%-4d", n));
		System.out.println();
		
		
		list.stream()
			.filter(n -> n % 2 == 0)
			.filter(n -> n >= 50)
			.forEach(n -> System.out.printf("%-4d", n));
		System.out.println();
		
		
		Data.getStringList().stream()
							.filter(word -> word.length() >= 5)
							.filter(word -> word.startsWith("애"))
							.forEach(word -> System.out.println(word));
		System.out.println();
		
		
		Data.getUserList().stream()
						  .filter(user -> user.getGender() == 1)
						  .filter(user -> user.getHeight() >= 180)
						  .filter(user -> user.getWeight() >= 80)
						  .forEach(user -> System.out.println(user));
		System.out.println();
			
	}

	private static void m3() {
		
		// 스트림을 얻어오는 방법
		// - stream()/여러가지 메서드를 호출
		// 1. 배열로부터
		// 2. 컬렉션으로부터
		// 3. 숫자 범위
		// 4. 파일로부터
		// 5. 디렉토리로부터
		// 6. ..
		
		
		// 1.
		int[] nums1 = { 10, 20, 30 };
		Arrays.stream(nums1).forEach(num -> System.out.println(num));
		System.out.println();
		
		// 2.
		List<Integer> nums2 = Data.getIntList(3);
		nums2.stream().forEach(num -> System.out.println(num));
		System.out.println();
		
		// 3.
		// Stream<T>
		// IntStream
		
		IntStream.range(1,  10).forEach(num -> System.out.println(num));
		System.out.println();
		
		try {
			
			// 4. 파일 읽기
			// - FileReader
			// - Scanner
			// - Stream
			Path path = Paths.get(".\\data\\score.dat"); // File 참조 객체 역할
			
			Files.lines(path).forEach(line -> System.out.println(line));
			
			
			// 5.
			Path dir = Paths.get("C:\\dev\\eclipse");
			Files.list(dir).forEach(p -> {
				System.out.println(p.getFileName());
				File file = p.toFile();
				System.out.println(file.isFile());
			}); //dir.listFiles()
			
		} catch (Exception e) {
			System.out.println("Ex71_Stream.m3() 예외 발생");
			e.printStackTrace();
		}
		
	}

	private static void m2() {
		
		// 배열(컬렉션) 탐색
		List<String> txt1 = Data.getStringList(10);
		System.out.println(txt1);
		
		
		// 1. for문(while문)
		for (int i = 0; i < txt1.size(); i++) {
			System.out.printf(" %s ", txt1.get(i));
		}
		System.out.println();
		
		// 2. 향상된 for문
		for (String s : txt1) {
			System.out.printf(" %s ", s);
		}
		
		// 3. iterator
		Iterator<String> iter = txt1.iterator();
		while (iter.hasNext()) {
			System.out.printf(" %s ", iter.next());
		}
		System.out.println();
		
		// 4. stream
		// 4.1 데이터 소스로부터 스트림을 얻기
		Stream<String> stream = txt1.stream();
		
		// 4.2 스트림 객체를 통해서 배열의 요소에 접근 가능 + 조작
		Consumer<String> c1 = s -> System.out.println("단어: " + s);
		
		// - 스트림으로부터 요소 하나를 꺼낸다.
		// - 꺼낸 요소를 Consumer에게 전달한다.
		// 	- c1.accept(문자열) 호출한다.
		stream.forEach(c1);
		System.out.println();
		
		txt1.stream().forEach(s -> System.out.println(s));
		System.out.println();
		
		// 숫자 10개 > 제곱 출력
		Data.getIntList(10)
					.stream()
					.forEach(num -> System.out.println(num * num));
		
		// Item 10개 > 정보 출력
		Data.getItemList().stream().forEach(item -> {
			System.out.println(item.getName());
			System.out.println(item.getColor());
			System.out.printf("%tF\n", item.getDate());
			System.out.println();
		});
		
	}

	private static void m1() {
		
		int[] nums1 = Data.getIntArray();
//		System.out.println(Arrays.toString(nums1));
		
		int[] nums2 = Data.getIntArray(10);
//		System.out.println(Arrays.toString(nums2));
		
		List<Integer> nums3 = Data.getIntList();
//		System.out.println(nums3);
		
		List<Integer> nums4 = Data.getIntList(10);
//		System.out.println(nums4);
		
		String[] txt1 = Data.getStringArray();
//		System.out.println(Arrays.toString(txt1));
		
		com.test.data.User[] ulist = Data.getUserArray();
//		System.out.println(Arrays.toString(ulist));
		
		Item[] ilist = Data.getItemArray();
		System.out.println(Arrays.toString(ilist));
		
	}
	

}



















